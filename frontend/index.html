<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2>Dashboard</h2>
    <div class="row">
      <a href="search.html" class="btn waves-effect waves-light">Search Workouts</a>
    </div>

    <h2>Add Workout</h2>
    <div class="row">
      <form id="addWorkoutForm" class="col s12">
        <div class="input-field col s4">
          <input id="add_duration" type="text" class="validate" required>
          <label for="add_duration">Duration</label>
        </div>
        <div class="input-field col s4">
          <input id="add_distance" type="text" class="validate" required>
          <label for="add_distance">Distance</label>
        </div>
        <div class="input-field col s4">
          <input id="add_workout_type" type="text" class="validate">
          <label for="add_workout_type">Workout Type</label>
        </div>
        <div class="input-field col s4">
          <input id="add_route_nickname" type="text" class="validate" required>
          <label for="add_route_nickname">Route Nickname</label>
        </div>
        <div class="input-field col s12">
          <button class="btn waves-effect waves-light" type="submit" name="action">
            Add Workout
          </button>
        </div>
      </form>
    </div>
  </div>

  <!--JavaScript at end of body for optimized loading-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    // API URL (replace with your actual API endpoint)
    const apiUrl = 'http://localhost:5000/workouts'; // Example URL, replace with yours

    // Function to fetch and display workouts
    async function fetchWorkouts() {
      const response = await fetch(apiUrl);
      const data = await response.json();
      const workouts = data.workouts;
      const workoutList = document.getElementById('workout-list');
      workoutList.innerHTML = '';

      workouts.forEach(workout => {
        const workoutItem = document.createElement('li');
        workoutItem.classList.add('collection-item');
        workoutItem.innerHTML = `
          <strong>Type:</strong> ${workout.workout_type}<br>
          <strong>Distance:</strong> ${workout.distance} km<br>
          <strong>Duration:</strong> ${workout.duration} minutes<br>
          <strong>Heart Rate:</strong> ${workout.heart_rate || 'N/A'} bpm<br>
          <strong>Route:</strong> ${workout.route_nickname || 'N/A'}
        `;
        workoutList.appendChild(workoutItem);
      });
    }

    // Event listener for add workout form submission
    document.getElementById('addWorkoutForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const duration = document.getElementById('add_duration').value;
      const distance = document.getElementById('add_distance').value;
      const workout_type = document.getElementById('add_workout_type').value;
      const route_nickname = document.getElementById('add_route_nickname').value;

      if (!duration || !distance || !route_nickname) {
        alert('Please fill in all required fields.');
        return;
      }

      const workout = {
        duration,
        distance,
        workout_type,
        route_nickname
      };

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(workout)
      });

      if (response.ok) {
        alert('Workout added successfully!');
        fetchWorkouts(); // Refresh the workout list
      } else {
        alert('Failed to add workout.');
      }
    });

    // Fetch all workouts on page load
    fetchWorkouts();
  </script>
</body>
</html>