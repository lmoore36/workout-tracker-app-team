<!DOCTYPE html>
<html lang="en">
  <head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import Materialize.css-->
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" media="screen,projection" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workout Tracker</title>
  </head>
  <body>
    <!-- Navbar -->
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo center">Workout Tracker</a>
      </div>
    </nav>

    <!-- Container for Workouts -->
    <div class="container">
      <h5>Your Workouts</h5>
      <ul id="workout-list" class="collection">
        <!-- Workouts will be inserted here by JavaScript -->
      </ul>

      <h5>Add a New Workout</h5>
      <!-- Form to Add New Workout -->
      <div class="row">
        <form id="workout-form" class="col s12">
          <div class="row">
            <div class="input-field col s6">
              <input id="workout-type" type="text" class="validate" required>
              <label for="workout-type">Workout Type</label>
            </div>
            <div class="input-field col s6">
              <input id="workout-distance" type="number" step="0.01" class="validate" required>
              <label for="workout-distance">Distance (km)</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="workout-duration" type="number" step="0.01" class="validate" required>
              <label for="workout-duration">Duration (minutes)</label>
            </div>
            <div class="input-field col s6">
              <input id="workout-heart-rate" type="number" step="1" class="validate">
              <label for="workout-heart-rate">Heart Rate (bpm)</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="route-nickname" type="text" class="validate">
              <label for="route-nickname">Route Nickname (optional)</label>
            </div>
            <div class="input-field col s6">
              <button class="btn waves-effect waves-light" type="submit" name="action">
                Add Workout
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      // API URL (replace with your actual API endpoint)
      const apiUrl = 'http://localhost:5555/workouts'; // Example URL, replace with yours

      // Function to fetch and display workouts
      async function fetchWorkouts() {
        const response = await fetch(apiUrl);
        const data = await response.json();
        const workouts = data.workouts;
        const workoutList = document.getElementById('workout-list');
        workoutList.innerHTML = '';

        workouts.forEach(workout => {
          const workoutItem = document.createElement('li');
          workoutItem.classList.add('collection-item');
          workoutItem.innerHTML = `
            <strong>Type:</strong> ${workout.workout_type}<br>
            <strong>Distance:</strong> ${workout.distance} km<br>
            <strong>Duration:</strong> ${workout.duration} minutes<br>
            <strong>Heart Rate:</strong> ${workout.heart_rate || 'N/A'} bpm<br>
            <strong>Route:</strong> ${workout.route_nickname || 'N/A'}
          `;
          workoutList.appendChild(workoutItem);
        });
      }

      // Function to add a new workout
      async function addWorkout(event) {
        event.preventDefault();
        const workout_type = document.getElementById('workout-type').value;
        const distance = document.getElementById('workout-distance').value;
        const duration = document.getElementById('workout-duration').value;
        const heart_rate = document.getElementById('workout-heart-rate').value || null;
        const route_nickname = document.getElementById('route-nickname').value || null;

        const workout = {
          workout_type,
          distance: parseFloat(distance),
          duration: parseFloat(duration),
          heart_rate: heart_rate ? parseInt(heart_rate) : null,
          route_nickname
        };

        // Send a POST request to the API
        await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(workout),
        });

        // Clear the form and refresh the workout list
        document.getElementById('workout-form').reset();
        fetchWorkouts();
      }

      // Initialize and fetch workouts when the page loads
      document.addEventListener('DOMContentLoaded', function() {
        fetchWorkouts();

        // Add event listener to the form to add workouts
        document.getElementById('workout-form').addEventListener('submit', addWorkout);
      });
    </script>
  </body>
</html>
